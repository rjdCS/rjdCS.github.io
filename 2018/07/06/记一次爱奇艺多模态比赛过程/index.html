<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="记一次爱奇艺多模态比赛过程"><meta name="keywords" content="比赛,记录"><meta name="author" content="JunDa Ren (Richard Ren)"><meta name="copyright" content="JunDa Ren (Richard Ren)"><title>记一次爱奇艺多模态比赛过程 | RJD's Blog</title><link rel="shortcut icon" href="/r-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css?version=1.6.0"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#介绍"><span class="toc-number">1.</span> <span class="toc-text"> 介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2018年7月6日"><span class="toc-number">2.</span> <span class="toc-text"> 2018年7月6日</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2018年7月7日"><span class="toc-number">3.</span> <span class="toc-text"> 2018年7月7日</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2018年7月8日-7月9日"><span class="toc-number">4.</span> <span class="toc-text"> 2018年7月8日-7月9日</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#对id2video进行数据可视化"><span class="toc-number">4.1.</span> <span class="toc-text"> 对ID2VIDEO进行数据可视化：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#对id2img_1hz进行数据可视化"><span class="toc-number">4.2.</span> <span class="toc-text"> 对ID2IMG_1hz进行数据可视化：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#对id2img_5hz进行数据可视化"><span class="toc-number">4.3.</span> <span class="toc-text"> 对ID2IMG_5hz进行数据可视化：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#两个可视化合并"><span class="toc-number">4.4.</span> <span class="toc-text"> 两个可视化合并：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2018年7月10日-8月1日"><span class="toc-number">5.</span> <span class="toc-text"> 2018年7月10日-8月1日</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#网络训练-7月10日-7月20日"><span class="toc-number">5.1.</span> <span class="toc-text"> 网络训练 7月10日-7月20日</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一次训练"><span class="toc-number">5.1.1.</span> <span class="toc-text"> 第一次训练</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第一次训练之后的数据预处理"><span class="toc-number">5.1.2.</span> <span class="toc-text"> 第一次训练之后的数据预处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二次网络训练"><span class="toc-number">5.1.3.</span> <span class="toc-text"> 第二次网络训练</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#图像检索-7月21日-7月30"><span class="toc-number">5.2.</span> <span class="toc-text"> 图像检索 7月21日-7月30</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://avatars2.githubusercontent.com/u/8386277?s=460&amp;v=4"></div><div class="author-info__name text-center">JunDa Ren (Richard Ren)</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">21</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">24</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">14</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://ww1.sinaimg.cn/large/73c0c3d4gy1ft1me20uzwj21hc0nmguu.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">RJD's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">记一次爱奇艺多模态比赛过程</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-06</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/参加比赛/">参加比赛</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">1,539</span><span class="post-meta__separator">|</span><span>阅读时长: 5 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><!-- # 爱奇艺多模态视频分析大赛 -->
<h1 id="介绍"><a class="markdownIt-Anchor" href="#介绍"></a> 介绍</h1>
<p>开这一篇博客是想记录一下参加比赛的一个过程，也是第一次参加深度学习的比赛，作为一个好的开端吧。</p>
<h1 id="2018年7月6日"><a class="markdownIt-Anchor" href="#2018年7月6日"></a> 2018年7月6日</h1>
<p>准备对数据集下手了，目前爱奇艺的数据集只是以<code>xxxxxxx.mp4 ID</code>的形式给出，所以我们需要对数据集进行预处理，最后得到了一个ID文件夹名对应一些视频的形式，如下图：</p>
<div align="center">
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ft1m8v61dfj20hb0ekab1.jpg" alt="明星ID"></p>
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ft1m9r1u45j20el064dgl.jpg" alt="一个ID对应不同的"></p>
</div>
<p>这种形式方便进行多目标分类。</p>
<p>目前打算采用的方法：①将视频做成截图的形式②由于视频较少，采用迁移学习的方法</p>
<h1 id="2018年7月7日"><a class="markdownIt-Anchor" href="#2018年7月7日"></a> 2018年7月7日</h1>
<p>任务：</p>
<ul>
<li>采用截图的形式，将每个ID对应的视频截取成图片的形式</li>
</ul>
<p>完成：效果如图所示</p>
<div align="center">
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ft2qs4l3czj21ct0pt7ts.jpg" alt="ID对应视频截图"></p>
</div>
<p>正在将文件夹上传到集群当作，希望明天能做迁移学习。</p>
<h1 id="2018年7月8日-7月9日"><a class="markdownIt-Anchor" href="#2018年7月8日-7月9日"></a> 2018年7月8日-7月9日</h1>
<p>这两天才把1hz的截图文件上传到集群当中，但是考虑到1hz的数据量实在是太大，达到40个G，这还只是part1数据，如果再加上part2的数据的话，情况将不可想象。</p>
<div align="center">
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ft4j2y055pj21cf0lsb29.jpg" alt=""></p>
</div>
<p>所以我们有将视频以5hz的形式截取视频的截图，以减小数据的大小。</p>
<div align="center">
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ft4j3goeqqj21cm0ocnhd.jpg" alt=""></p>
</div>
<p>接下来我们将对数据进行可视化操作，以对数据有一个更直观的感受。</p>
<h2 id="对id2video进行数据可视化"><a class="markdownIt-Anchor" href="#对id2video进行数据可视化"></a> 对ID2VIDEO进行数据可视化：</h2>
<div align="center">
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ft4j4x23uzj21uo0yr764.jpg" alt=""></p>
</div>
<p>我们可以看到：每个ID对应许多的视频文件，一个ID最多对应的视频数为69，最低为1。<br>
我们可能不会采用视频的形式进行神经网络的学习。所有这个可视化，我们仅供参考。看看就行。</p>
<h2 id="对id2img_1hz进行数据可视化"><a class="markdownIt-Anchor" href="#对id2img_1hz进行数据可视化"></a> 对ID2IMG_1hz进行数据可视化：</h2>
<p>对ID2IMG_1hz(1帧的频率截取的图片)进行数据可视化：</p>
<div align="center">
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ft4j58f12ej21uo0yr40h.jpg" alt=""></p>
</div>
<p>我们可以看到：数据量实在是太多，平均每个ID文件有800左右的图片，最高数据为7000左右，最低为50左右。这还只是1G的视频文件呢。瑟瑟发抖。</p>
<h2 id="对id2img_5hz进行数据可视化"><a class="markdownIt-Anchor" href="#对id2img_5hz进行数据可视化"></a> 对ID2IMG_5hz进行数据可视化：</h2>
<p>于是，我们考虑采用5hz的形式进行截图，可视化：</p>
<div align="center">
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ft4j5f2c08j21uo0yrmz3.jpg" alt=""></p>
</div>
<h2 id="两个可视化合并"><a class="markdownIt-Anchor" href="#两个可视化合并"></a> 两个可视化合并：</h2>
<div align="center">
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ft4j5lkwy1j21uo0yr40w.jpg" alt=""></p>
</div>
<p>我们可以看到：与1hz的相比，数据的分布还是具有一致性的（废话！），但是数据的大小大大降低，但是每个ID对应的图片数量也大大降低了，不知道对网络学习是否有影响。若有影响或将采取以下方案：</p>
<ul>
<li>数据增强</li>
<li>迁移学习</li>
</ul>
<h1 id="2018年7月10日-8月1日"><a class="markdownIt-Anchor" href="#2018年7月10日-8月1日"></a> 2018年7月10日-8月1日</h1>
<p>这段时间一直在忙着训练网络，修改参数。没有时间更新，好在能得到一个比较好的结果：</p>
<h2 id="网络训练-7月10日-7月20日"><a class="markdownIt-Anchor" href="#网络训练-7月10日-7月20日"></a> 网络训练 7月10日-7月20日</h2>
<h3 id="第一次训练"><a class="markdownIt-Anchor" href="#第一次训练"></a> 第一次训练</h3>
<ul>
<li>数据集：5hz训练集图片</li>
<li>网络结构：Resnet50（pre-trained）</li>
<li>模式：迁移学习 fine-tune</li>
<li>epoch次数：20</li>
</ul>
<p>我们用Resnet50的网络结构进行迁移学习，学习我们所要的图片特征：</p>
<div align="center">
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ftvmb18w61j20pp09hwi4.jpg" alt=""></p>
</div>
<p>我们可以看到我们的数据在训练集上的准确度是比较好的，最后可以达到99.1%。但是在验证集上的表现不是很好，虽然也可以达到74.8%，但是要达到我们所需要的准确度还是有一定的差距的。</p>
<h3 id="第一次训练之后的数据预处理"><a class="markdownIt-Anchor" href="#第一次训练之后的数据预处理"></a> 第一次训练之后的数据预处理</h3>
<p>我们考虑是数据集的问题，于是我们对数据集进行处理，采用MTCNN对数据中的脸部数据进行保留，只保留人脸：</p>
<p>数据处理前：</p>
<div align="center">
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ftvmlg32qgj20ow0e0myt.jpg" alt=""></p>
</div>
<p>MTCNN处理之后：</p>
<div align="center">
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ftvmlg2p5tj202o034742.jpg" alt=""></p>
</div>
<p>我们将part1中所有的数据进行“扣脸”处理。</p>
<h3 id="第二次网络训练"><a class="markdownIt-Anchor" href="#第二次网络训练"></a> 第二次网络训练</h3>
<ul>
<li>数据集：5hz训练集图片 <strong>进行了“扣脸”处理</strong></li>
<li>网络结构：Resnet50（pre-trained）</li>
<li>模式：迁移学习 fine-tune</li>
<li>epoch次数：20</li>
</ul>
<p>结果如下：</p>
<div align="center">
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ftvmqenpgvj20lm09jwhe.jpg" alt=""></p>
</div>
<p>我们可以看到：我们在训练集上的准确度可以达到96%，但是在验证集上的准确率只有区区的2.1%。我们怀疑是不是不应该进行“扣脸”处理，所有我们放弃这一次的训练。<strong>保存了第一次训练的模型和参数</strong></p>
<h2 id="图像检索-7月21日-7月30"><a class="markdownIt-Anchor" href="#图像检索-7月21日-7月30"></a> 图像检索 7月21日-7月30</h2>
<p>我们将第一次训练好的模型以及参数保存下来，进行图像检索。</p>
<p>图像检索我们采用“余弦相似度”的方法进行比较两个图片的显示度（之后会写一篇文章详细的介绍<em>余弦相似度</em>）。</p>
<p>主要方案如下：</p>
<ul>
<li>1.将需要检索的图片载入训练好的模型当中。</li>
<li>2.模型会输出这个图片的向量（tensor）形式。</li>
<li>3.我们将检索池中的待检索图片进行12步，得到待检索图片的向量（tensor）形式。</li>
<li>4.利用余弦相似度进行两个图片的对比，将相似度高的图片保留，最后得到检索结果。</li>
</ul>
<p>我们采用每一个ID的第</p>
<p>结果如下：</p>
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ftvniy7ic5j20ty0mrwhp.jpg" alt=""></p>
<p>我们检测ID1：</p>
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ftvnnedx5pj20ep05iaa4.jpg" alt=""></p>
<p>我们能完全的检测到！！！很棒！</p>
<p>我们再随机抽取ID20：</p>
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ftvnopr4amj20fn04x0sq.jpg" alt=""></p>
<p>我们可以打开预测错误的视频：</p>
<p>0270：</p>
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ftvntirhgkj20nk0dctaq.jpg" alt=""></p>
<p>0827：</p>
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ftvntirlacj20nk0d4wgr.jpg" alt=""></p>
<p>我们看到相似度并不是很高，我们查看这两个图片的余弦相似度：</p>
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ftvo42i0nqj206d01idfn.jpg" alt=""></p>
<p>只有0.6604，可以看到相似度并不是很高，我们再看看，原始图片：</p>
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ftvo79xdklj20nk0dcgnc.jpg" alt=""></p>
<p>我们将原图和0270计算相似度得到：</p>
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ftvo79v3zcj206x01o3yb.jpg" alt=""></p>
<p>再将原图与0827计算相似度得到：</p>
<p><img src="http://ww1.sinaimg.cn/large/73c0c3d4gy1ftvo7a5kwcj206101idfn.jpg" alt=""></p>
<p>于是我们可以将阈值提高：<strong>只有相似度达到90%以上</strong>才能判断为同一人物（ID）</p>
<p>同时，我们再查看其它图片时发现，同一视频来源的图片（视频）更容易被找到。</p>
<p><strong>解决方案：我们将ID下的每个视频都截取一帧关键帧（特征最明显的）作为检索图片，这样即使提高相似度阈值，我们也能准确的找到相同的人（目前的想法）</strong></p>
<p>同时，我们也要重新对数据集进行处理，保证数据集的干净程度满足要求。</p>
<p>接下来的任务：从数据集预处理开始，重新完成一次。</p>
</div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/比赛/">比赛</a><a class="post-meta__tags" href="/tags/记录/">记录</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/10/13/一文入门numpy/"><i class="fa fa-chevron-left">  </i><span>一文入门numpy</span></a></div><div class="next-post pull-right"><a href="/2018/03/12/Linux中GPU使用情况/"><span>查看Linux中GPU使用情况</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(http://ww1.sinaimg.cn/large/73c0c3d4gy1ft1me20uzwj21hc0nmguu.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2019 By JunDa Ren (Richard Ren)</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.0"></script><script src="/js/fancybox.js?version=1.6.0"></script><script src="/js/sidebar.js?version=1.6.0"></script><script src="/js/copy.js?version=1.6.0"></script><script src="/js/fireworks.js?version=1.6.0"></script><script src="/js/transition.js?version=1.6.0"></script><script src="/js/scroll.js?version=1.6.0"></script><script src="/js/head.js?version=1.6.0"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>